version: 2

models:
  - name: campaign_changes
    description: "Tracks detected changes in campaign details, including budget, dates, channels, and activity status."
    columns:
      - name: campaign_id
        data_type: varchar
        description: "Unique identifier for the campaign."
        tests:
          - not_null
          - unique
      - name: change_detected_at
        data_type: timestamp_ltz
        description: "Timestamp when the change was detected."
        tests:
          - not_null
      - name: change_type
        data_type: varchar
        description: "Type of change detected, such as budget or date changes."
        tests:
          - not_null
      - name: previous_budget
        data_type: float
        description: "The budget of the campaign before the change."
        tests:
          - dbt_utils.expression_is_true:
              expression: " >= 0"
      - name: current_budget
        data_type: float
        description: "The updated budget of the campaign."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " >= 0"
      - name: previous_start_date
        data_type: date
        description: "The start date of the campaign before the change."
      - name: current_start_date
        data_type: date
        description: "The updated start date of the campaign."
      - name: previous_end_date
        data_type: date
        description: "The end date of the campaign before the change."
      - name: current_end_date
        data_type: date
        description: "The updated end date of the campaign."
        tests:
          - dbt_utils.expression_is_true:
              expression: " > current_start_date"
      - name: previous_channel
        data_type: varchar
        description: "The channel used for the campaign before the change (e.g., online, TV)."
      - name: current_channel
        data_type: varchar
        description: "The updated channel used for the campaign."
      - name: previous_is_active
        data_type: boolean
        description: "Indicates whether the campaign was active before the change."
      - name: current_is_active
        data_type: boolean
        description: "Indicates whether the campaign is currently active."
        tests:
          - not_null

  - name: campaign_effectiveness
    description: "Analyzes the effectiveness of campaigns, including revenue, sales count, and ROI."
    columns:
      - name: campaign_id
        data_type: varchar
        description: "Unique identifier for the campaign."
        tests:
          - not_null
      - name: campaign_name
        data_type: varchar
        description: "Name of the campaign."
        tests:
          - not_null
      - name: sales_month
        data_type: date
        description: "The month in which sales occurred."
        tests:
          - not_null
      - name: total_sales_revenue
        data_type: float
        description: "Total revenue generated by the campaign during the month."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " >= 0"
      - name: total_sales_count
        data_type: number
        description: "Total number of sales associated with the campaign during the month."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " >= 0"
      - name: campaign_budget
        data_type: float
        description: "The budget allocated to the campaign."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " >= 0"
      - name: roi
        data_type: float
        description: "Return on investment for the campaign, calculated as (revenue - budget)."
        tests:
          - dbt_utils.expression_is_true:
              expression: " >= -campaign_budget"

  - name: dim_campaigns
    description: "Dimension table containing details about marketing campaigns, including their budgets and channels."
    columns:
      - name: campaign_id
        data_type: varchar
        description: "Unique identifier for each campaign."
        tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        description: "Name of the marketing campaign."
        tests:
          - not_null
      - name: start_date
        data_type: date
        description: "The start date of the campaign."
        tests:
          - not_null
      - name: end_date
        data_type: date
        description: "The end date of the campaign."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " > start_date"
      - name: budget_usd
        data_type: float
        description: "The budget allocated for the campaign, in USD."
      - name: channel
        data_type: varchar
        description: "The primary channel used for the campaign (e.g., online, TV, print)."
      - name: is_active
        data_type: boolean
        description: "Indicates whether the campaign is currently active."
      - name: last_updated_utc
        data_type: timestamp_ntz
        description: "Timestamp of the last update to the campaign record."
        
  - name: dim_promotions
    description: "Dimension table containing information about dealership promotions, including discount details and associated campaigns."
    columns:
      - name: promotion_id
        data_type: varchar
        description: "Unique identifier for each promotion."
        tests:
          - not_null
          - unique
      - name: name
        data_type: varchar
        description: "Name of the promotion."
        tests:
          - not_null
      - name: start_date
        data_type: date
        description: "The start date of the promotion."
        tests:
          - not_null
      - name: end_date
        data_type: date
        description: "The end date of the promotion."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: " > start_date"
      - name: discount_type
        data_type: varchar
        description: "Type of discount offered (e.g., percentage, fixed amount)."
      - name: discount_value
        data_type: float
        description: "The value of the discount offered."
      - name: campaign_id
        data_type: varchar
        description: "Identifier for the associated campaign."
      - name: is_active
        data_type: boolean
        description: "Indicates whether the promotion is currently active."
      - name: last_updated_utc
        data_type: timestamp_ntz
        description: "Timestamp of the last update to the promotion record."